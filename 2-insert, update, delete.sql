INSERT INTO line (line_number, line_name, wagons_in_trains) VALUES
(1, 'Кировско-Выборгская', 8),
(2, 'Московско-Петроградская', 6),
(4, 'Правобережная', 7),
(8, 'Кольцевая', NULL);

INSERT INTO station (id, station_name,  line_number,  opening_time,  closing_time,  commissioning_date) VALUES
(1, 'Девяткино', 1, '05:32', '00:00', '1978.12.29'),
(2, 'Гражданский Проспект', 1, '05:35', '00:40', '1978.12.29'),
(3, 'Академическая', 1, '05:35', '00:40', '1975.12.31'),
(4, 'Политехническая', 1, '05:37', '00:39', '1975.12.31'),
(5, 'Площадь Мужества', 1, '05:40', '00:37', '1975.12.31'),
(6, 'Лесная', 1, '05:42', '00:33', '1975.04.22'),
(7, 'Выборгская', 1, '05:45', '00:30', '1975.04.22'),
(8, 'Площадь Ленина', 1, '05:46', '00:28', '1958.06.01'),
(9, 'Чернышевская', 1, '05:48', '00:25', '1958.09.01'),
(10, 'Площадь Восстания', 1, '05:40', '00:25', '1995.11.15'),
(11, 'Владимирская', 1, '05:38', '00:26', '1955.11.15'),
(12, 'Пушкинская', 1, '05:38', '00:28', '1956.04.30'),
(13, 'Технологический Институт 1', 1, '07:00', '20:00', '1955.10.15'),
(14, 'Балтийская', 1, '05:36', '00:33', '1955.11.15'),
(15, 'Нарвская', 1, '05:36', '00:36', '1955.11.15'),
(16, 'Кировский Завод', 1, '05:30', '00:40', '1955.11.15'),
(17, 'Автово', 1, '05:30', '00:42', '1955.11.15'),
(18, 'Ленинский Проспект', 1, '05:40', '00:45', '1977.09.29'),
(19, 'Проспект Ветенаров', 1, '05:38', '00:00', '1977.09.29'),
(20, 'Парнас', 2, '05:45', '00:00', '2006.12.22'),
(21, 'Проспект Просвещения', 2, '05:57', '00:45', '1988.08.19'),
(22, 'Озерки', 2, '05:41', '00:41', '1988.08.19'),
(23, 'Удельная', 2, '05:43', '00:38', '1982.11.04'),
(24, 'Пионерская', 2, '05:45', '00:35', '1982.11.04'),
(25, 'Чёрная Речка', 2, '05:45', '00:32', '1982.11.04'),
(26, 'Петроградская', 2, '05:35', '00:28', '1963.07.01'),
(27, 'Горьковская', 2, '05:37', '00:26', '1963.07.01'),
(28, 'Невский Проспект', 2, '05:36', '23:00', '1963.07.01'),
(29, 'Сенная Площадь', 2, '05:36', '00:26', '1963.07.01'),
(30, 'Технологический Институт 2', 2, '07:00', '20:00', '1961.04.11'),
(31, 'Фрунзенская', 2, '05:45', '00:30', '1961.04.29'),
(32, 'Московские Ворота', 2, '05:43', '00:33', '1961.04.29'),
(33, 'Электросила', 2, '05:45', '00:30', '1961.04.29'),
(34, 'Парк Победы', 2, '05:45', '00:30', '1961.04.29'),
(35, 'Московская', 2, '05:31', '00:32', '1969.12.25'),
(36, 'Звёздная', 2, '05:31', '00:45', '1972.12.25'),
(37, 'Купчино', 2, '05:30', '00:00', '1972.12.25'),
(38, 'Спасская', 4, '05:38', '00:08', '2009.03.07'),
(39, 'Достоевская', 4, '06:55', '20:00', '1991.12.30'),
(40, 'Лиговский Проспект', 4, '05:40', '00:17', '1991.12.30'),
(41, 'Площадь Александра Невского', 4, '06:55', '20:00', '1985.12.30'),
(42, 'Новочеркасская', 4, '05:39', '00:19', '1985.12.30'),
(43, 'Ладожская', 4, '05:40', '00:20', '1985.12.30'),
(44, 'Проспект Большевиков', 4, '05:37', '00:23', '1985.12.30'),
(45, 'Улица Дыбенко', 4, '05:35', '00:05', '1987.10.01');

INSERT INTO route (departure_station_id, arrival_station_id, commute_time) VALUES
(1, 2, 5),
(2, 3, 5),
(3, 4, 5),
(4, 5, 5),
(5, 6, 5),
(6, 7, 5),
(7, 8, 5),
(8, 9, 5),
(9, 10, 5.5),
(10, 11, 5),
(11, 12, 6.5),
(12, 13, 5),
(13, 14, 5),
(14, 15, 5.5),
(15, 16, 5.5),
(16, 17, 5),
(17, 18, 4),
(18, 19, 4),
(20, 21, 4.5),
(21, 22, 5),
(22, 23, 4.5),
(23, 24, 4.5),
(24, 25, 4.5),
(25, 26, 5.5),
(26, 27, 5),
(27, 28, 7.5),
(28, 29, 6),
(29, 30, 9.5),
(30, 31, 5.5),
(31, 32, 5),
(32, 33, 5),
(33, 34, 5),
(34, 35, 5),
(35, 36, 5),
(36, 37, 5),
(38, 39, 3),
(39, 40, 2),
(40, 41, 3),
(41, 42, 2),
(42, 43, 2),
(43, 44, 2),
(44, 45, 2);

INSERT INTO interchange (station_a_id, station_b_id) VALUES
(13, 30),
(11, 39),
(29, 38),
(30, 13),
(38, 29),
(39, 11);

INSERT INTO street (id, street_name) VALUES
(1, 'Привокзальная площадь'),
(2, 'Гражданский Проспект'),
(3, 'Науки проспект'),
(4, 'Политехническая'),
(5, 'Кантемировская'),
(6, 'Смолячкова'),
(7, 'Ленина площадь'),
(8, 'Чернышевского проспект'),
(9, 'Восстания площадь'),
(10, 'Большая Московская'),
(11, 'Загородный проспект'),
(12, 'Московский проспект'),
(13, 'Балтийского вокзала площадь'),
(14, 'Стачек площадь,'),
(15, 'Стачек проспект'),
(16, 'Новаторов бульвар'),
(17, 'Энгельса проспект'),
(18, 'Выборгское шоссе'),
(19, 'Елецкая'),
(20, 'Коломяжский проспект'),
(21, 'Академика Крылова'),
(22, 'Камменоостровский проспект'),
(23, 'Александровский парк'),
(24, 'Невский проспект'),
(25, 'Сенная Площадь'),
(26, 'Загородный проспект'),
(27, 'Московский проспект'),
(28, 'Звёздная'),
(29, 'Витебский проспект'),
(30, 'Ефимова'),
(31, 'Владимирский проспект'),
(32, 'Лиговский проспект'),
(33, 'Александра Невского площадь'),
(34, 'Заневский проспект'),
(35, 'Коллонтай'),
(36, 'Дыбенко');

INSERT INTO exit (street_id, station_id, building_number) VALUES
(1, 1, 6),
(2, 2, 116),
(3, 3, 19),
(4, 4, 29),
(4, 5, 17),
(5, 6, 25),
(6, 7, 21),
(7, 8, 6),
(8, 9, 20),
(9, 10, 2),
(10, 11, 2),
(11, 12, 50),
(12, 13, 28),
(13, 14, 1),
(14, 15, 2),
(15, 16, 70),
(15, 17, 90),
(16, 18, 11),
(16, 19, 108),
(17, 20, 162),
(17, 21, 140),
(18, 22, 1),
(19, 23, 15),
(20, 24, 24),
(21, 25, 2),
(22, 26, 37),
(23, 27, 6),
(24, 28, 30),
(25, 29, 2),
(26, 30, 74),
(27, 31, 71),
(27, 32, 103),
(27, 33, 141),
(27, 34, 188),
(27, 35, 195),
(28, 36, 3),
(29, 37, 108),
(30, 38, 2),
(31, 39, 23),
(32, 40, 88),
(33, 41, 2),
(34, 42, 17),
(34, 43, 69),
(35, 44, 20),
(36, 45, 26);

-- copy db
CREATE DATABASE subway2 TEMPLATE subway;

UPDATE line SET wagons_in_trains=wagons_in_trains-1 WHERE line_number=2;
DELETE FROM route WHERE commute_time>5;

-- copy table
CREATE TABLE new_station AS TABLE station WITH NO DATA;
ALTER TABLE new_station ADD COLUMN action VARCHAR(3);

INSERT INTO new_station (id, station_name,  line_number) VALUES
(46, 'Путиловская', 6),
(47, 'Юго-Западная', 6);
INSERT INTO new_station (id, station_name,  line_number,  opening_time, action) VALUES
(44, 'Проспект Большевиков', 4, '05:30', 'Mod'),
(45, 'Улица Дыбенко', 4, '05:30', 'Mod');
INSERT INTO new_station (id, station_name, action) VALUES
(42, 'Новочеркасская', 'Del'),
(43, 'Ладожская', 'Del');
INSERT INTO line (line_number, line_name) VALUES
(6, 'Красносельско-Калининская');

MERGE INTO station AS S
    USING new_station AS R
    ON (S.station_name = R.station_name)
WHEN MATCHED AND R.action = 'Mod' THEN
    UPDATE SET opening_time = R.opening_time
WHEN MATCHED AND R.action = 'Del' THEN
    DELETE
WHEN NOT MATCHED
    THEN INSERT (id, station_name,  line_number,  opening_time,  closing_time,  commissioning_date) 
    VALUES (R.id, R.station_name,  R.line_number,  R.opening_time,  R.closing_time,  R.commissioning_date);